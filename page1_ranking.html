<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Page</title>
  <link rel="stylesheet" href="modern-normalize.css">
  <link rel="stylesheet" href="main.css">
</head>

<!-- Prettier complains if we use '<', so we to find another way to pad. -->
{% macro render_player(p) -%}
{{"&nbsp;"|safe if p.rank//10 == 0 else ""}}{{p.rank}} {{p.nationality.flag_emoji}} {{p.name_first}} {{p.name_last}}
{%- endmacro %}

{% macro render_rank_change_award_table(rows) -%}
<table class="award_table">
  <thead>
    <tr>
      <th class="text-center">Player</th>
      <th class="text-right">Age</th>
      <th class="text-right">{{ date_past }}</th>
      <th class="text-right">{{ date_now }}</th>
      <th class="text-right">Difference</th>
    </tr>
  </thead>
  <tbody>
    {% for row in rows %}
    <tr>
      <td class="text-left">{{ render_player(row.player) }}</td>
      <td class="text-right">{{ row.player.age }}</td>
      <td class="text-right">{{ row.rank_past }}</td>
      <td class="text-right">{{ row.rank_now }}</td>
      <td class="text-right">{{ row.rank_change }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{%- endmacro %}

{% macro render_rank_spread_table(rows) -%}
<table class="award_table">
  <thead>
    <tr>
      <th class="text-center">Player</th>
      <th class="text-right">Age</th>
      <th class="text-right">Highest rank</th>
      <th class="text-right">Lowest rank</th>
      <th class="text-right">Spread</th>
    </tr>
  </thead>
  <tbody>
    {% for row in rows %}
    <tr>
      <td class="text-left">{{ render_player(row.player) }}</td>
      <td class="text-right">{{ row.player.age }}</td>
      <td class="text-right">{{ row.rank_highest }}</td>
      <td class="text-right">{{ row.rank_lowest }}</td>
      <td class="text-right">{{ row.rank_spread }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{%- endmacro %}


<body>
  <div style="width: {{ width }}px; padding: 0 {{ padding_x }}px; margin: 0 auto;">
    <h1>RANKING</h1>

    <!-- MARK: Rank change -->

    <h2>Rank change since {{ date_past }}</h2>
    <img src="{{ rank_change_chart }}">

    <div class="award_group">
      <p class="award_emoji">🦄</p>
      <p class="award_p">Unicorn award for the biggest raise.</p>
      <p class="award_p">
        {{ player_no_1.name_first }} {{ player_no_1.name_last }} ending the year as No. 1 is impressive,<br />
        but gaining {{ rank_change_max_gain }} positions in PIF ATP Ranking is also nice.
      </p>
      {{ render_rank_change_award_table(rank_change_awards_max_gain) }}
    </div>

    <div class="award_group">
      <p class="award_emoji">🦨</p>
      <p class="award_p">Skunk award for the biggest drop.</p>
      {{ render_rank_change_award_table(rank_change_awards_max_drop) }}
    </div>

    <div class="award_group">
      <p class="award_emoji">🦥</p>
      <p class="award_p">Sloth award for… hanging in there.</p>
      {{ render_rank_change_award_table(rank_change_awards_no_change) }}
    </div>

    <!-- MARK: Rank spread -->

    <h2>Rank spread since {{ date_past }}</h2>
    <img src="{{ rank_spread_chart }}">

    <div class="award_group">
      <p class="award_emoji">🪺</p>
      <p class="award_p">Nest award for the most consistent players.</p>
      {{ render_rank_spread_table(rank_spread_awards_min) }}
    </div>

    <div class="award_group">
      <p class="award_emoji">🐇</p>
      <p class="award_p">Bunny award for those who like to hop around.</p>
      {{ render_rank_spread_table(rank_spread_awards_max) }}
    </div>

  </div>
</body>

</html>
